システムテストのポイント

次期基盤への変更点から想定される影響を想定し、何を指標に負荷を算出するか。
少なくとも本番運用に近い業務操作でシステムに負荷を与える体制が必要でしょうね。


システム構成の変更点：
とりあえず、自分が認識しているインフラ変更点について影響を検討する。

(1)APサーバのインスタンス構成
(2)セッションデータの保存方式
(3)出力ファイルの保存場所
(4)バッチ実行サーバ
(5)SVFとOpenOfficeの実行方式
※個々の機器の性能についてはITISが保証しているので省略


(1)
現行：全てのアプリを1つのWebLogicインスタンスで構築
次期基盤：アプリ単位にtomcatインスタンスに分割
懸念点：JavaVMのメモリ効率が悪化
影響：GC処理増による操作性の悪化
評価案：
現行のGC発生状況、つまりFullGC発生が1回/日程度との比較は無謀。
本来ならば、ピーク時のシステム利用状況に合わせた操作でのGCの発生状況で評価する。
テスト時の測定値を加算（※）して本番時の負荷を見込むしかないのでしょうね？
※情シスと倍率を握る、もしくは、新たな指針を定義してもらう

(2)
現行：APサーバのヒープ内に確保
次期基盤：Redisにデータを保存
懸念点：想定される利用者数に対するセッションデータ量を保持することができるか
影響：使用中にアプリのセッションが切れる
評価案：
テスト時の人数とRedisの最大使用メモリ量の比率から、
システムのセッションtimeout時間内の最大利用者数を想定して必要なメモリ量を算出する。

(3)
現行：ローカルディスクに出力
次期基盤：NFS経由でファイルサーバに出力
懸念点：処理集中に対してNFS性能が許容範囲内かどうか
影響：cpu waitによる操作性の悪化
評価案：
本番ピークに出力されるファイル量とテスト時では大きく異なるので、
現行で処理が集中している時期のログや帳票などの出力ファイルの総サイズと
テストで出力されたファイルサイズの比率に対するcpu wait率（※）から算出する。
で意味があるかどうか判断できない？
※wait率は誤差が大きい、かつ、負荷増に伴い急速に悪化する

(4)省略
※一言：ここでは関係ないが障害時の業務継続が心配

(5)
現行：APサーバで実行
次期基盤：別サーバで処理
懸念点：大きな（複雑な？）帳票でも処理時間が許容範囲内か？
影響：通信などの中間処理の介在やcpu数減による応答時間の悪化
評価案：特になし。（リモート化の問題なので容認してもらうしかないので）
※とりあえず計測するとしてもUTの範疇


補足：
万が一、何だかの問題が生じた場合の懸念事項として
(1)(2)は、tomcat/redisの設定値の調整でどうにかなると考える。
万が一、それでも解決しない場合は、Workerノードのメモリ割当を追加する対策になるが、
ESXiサーバにはメモリの余裕があったはずなので、H/W追加など大きな増強は不要なはず。
しかし、(3)は、一時的であればログの出力レベル変更などで対処できると考えるが、
最終的にはログ出力の仕組みを変更する可能性があるので、早めの確認が必要かもしれない？
ここでは省略したが、(4)も似たような状況と考える。
